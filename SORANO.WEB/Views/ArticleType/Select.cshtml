@model ArticleTypeSelectModel

@{
    ViewBag.Title = "SORANO - Добавление типа артикулов";
    ViewBag.Header = "Добавление";
    ViewBag.Description = "родительского типа артикулов";
}

@section Breadcrumb {
    <ul class="breadcrumb">
        <li><a asp-controller="Home" asp-action="Index">Главная</a></li>
        <li><a asp-controller="Article" asp-action="Index">Артикулы</a></li>
        <li><a asp-controller="ArticleType" asp-action="Create">Создание типа артикулов</a></li>
        <li class="active">Добавление родительского типа</li>
    </ul>
}

<div class="row">
    <div class="col-lg-6">
        <p class="text-info">
            <i class="fa fa-fw fa-info" aria-hidden="true"></i>
            Для назначения родительского типа выберите необходимый тип в дереве
        </p>
        <form asp-controller="ArticleType"
              asp-action=""
              method="post"
              asp-antiforgery="true">
            <input type="hidden" asp-for="ArticleType.ID" />
            <input type="hidden" asp-for="ArticleType.Name" />
            <input type="hidden" asp-for="ArticleType.Description" />
            @if (Model.ArticleType.ParentType != null)
            {
                <input type="hidden" asp-for="ArticleType.ParentType.ID" />
                <input type="hidden" asp-for="ArticleType.ParentType.Name" />
                <input type="hidden" asp-for="ArticleType.ParentType.Description" />
            }
            @for (var i = 0; i < Model.Types.Count; i++)
            {
                @Html.HiddenFor(m => m.Types[i].ID)
                @Html.HiddenFor(m => m.Types[i].Name)
                @Html.HiddenFor(m => m.Types[i].Description)
                @Html.HiddenFor(m => m.Types[i].IsSelected, new { id = "typeID_" + Model.Types[i].ID, @class = "selectedInput" })
            }
            <input type="hidden" asp-for="ReturnUrl" />
            <div class="form-group">
                <input class="form-control input-sm" style="font-weight: bold;" placeholder="Поиск типов артикулов" type="text" id="article-search" />
                <br />
                <div class="tree">
                    <article-types-tree elements="@Model.Types" detailed="false" show-articles="false"></article-types-tree>
                </div>
            </div>
            <div class="form-group">
                <button type="submit" class="btn btn-default" asp-action="Cancel">Отмена</button>
                <button type="submit" class="btn btn-primary" asp-action="Select">Сохранить</button>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            $('.tree li:has(ul)').addClass('parent_li').find(' > span').attr('title', 'Свернуть ветку');
            $('.tree li.parent_li > span').on('click', function () {
                var children = $(this).parent('li.parent_li').find(' > ul > li');
                if (children.is(":visible")) {
                    children.hide('fast');
                    $(this).attr('title', 'Развернуть ветку').find(' > i').addClass('fa-tags').removeClass('fa-tag');
                    $(this).find(' > span').show('fast');
                } else {
                    children.show('fast');
                    $(this).attr('title', 'Свернуть ветку').find(' > i').addClass('fa-tag').removeClass('fa-tags');
                    $(this).find(' > span').hide('fast');
                }
            });
            $('.tree li').on('click', function (e) {
                var id = $(this).attr('id');
                var input = $('#typeID_' + id), val = input.val();
                $('.selectedInput').val("False");
                $('.tree li.selected').removeClass('selected');
                input.val(val === "True" ? "False" : "True");
                $(this).addClass('selected');
                e.stopPropagation();
            });
        });
    </script>
}
